(function(t,e){"use strict";var n,i=t.document,r=t.Modernizr,s=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},o="Moz Webkit O Ms".split(" "),a=function(t){var e,n=i.documentElement.style;if(typeof n[t]=="string")return t;t=s(t);for(var r=0,a=o.length;a>r;r++)if(e=o[r]+t,typeof n[e]=="string")return e},u=a("transform"),l=a("transitionProperty"),h={csstransforms:function(){return!!u},csstransforms3d:function(){var t=!!a("perspective");if(t){var n=" -o- -moz- -ms- -webkit- -khtml- ".split(" "),i="@media ("+n.join("transform-3d),(")+"modernizr)",r=e("<style>"+i+"{#modernizr{height:3px}}"+"</style>").appendTo("head"),s=e('<div id="modernizr" />').appendTo("html");t=s.height()===3,s.remove(),r.remove()}return t},csstransitions:function(){return!!l}};if(r)for(n in h)r.hasOwnProperty(n)||r.addTest(n,h[n]);else{r=t.Modernizr={_version:"1.6ish: miniModernizr for Isotope"};var c,f=" ";for(n in h)c=h[n](),r[n]=c,f+=" "+(c?"":"no-")+n;e("html").addClass(f)}if(r.csstransforms){var d=r.csstransforms3d?{translate:function(t){return"translate3d("+t[0]+"px, "+t[1]+"px, 0) "},scale:function(t){return"scale3d("+t+", "+t+", 1) "}}:{translate:function(t){return"translate("+t[0]+"px, "+t[1]+"px) "},scale:function(t){return"scale("+t+") "}},p=function(t,n,i){var r,s,o=e.data(t,"isoTransform")||{},a={},l={};a[n]=i,e.extend(o,a);for(r in o)s=o[r],l[r]=d[r](s);var h=l.translate||"",c=l.scale||"",f=h+c;e.data(t,"isoTransform",o),t.style[u]=f};e.cssNumber.scale=!0,e.cssHooks.scale={set:function(t,e){p(t,"scale",e)},get:function(t){var n=e.data(t,"isoTransform");return n&&n.scale?n.scale:1}},e.fx.step.scale=function(t){e.cssHooks.scale.set(t.elem,t.now+t.unit)},e.cssNumber.translate=!0,e.cssHooks.translate={set:function(t,e){p(t,"translate",e)},get:function(t){var n=e.data(t,"isoTransform");return n&&n.translate?n.translate:[0,0]}}}var m,g;r.csstransitions&&(m={WebkitTransitionProperty:"webkitTransitionEnd",MozTransitionProperty:"transitionend",OTransitionProperty:"oTransitionEnd",transitionProperty:"transitionEnd"}[l],g=a("transitionDuration"));var v,y=e.event;y.special.smartresize={setup:function(){e(this).bind("resize",y.special.smartresize.handler)},teardown:function(){e(this).unbind("resize",y.special.smartresize.handler)},handler:function(t,e){var n=this,i=arguments;t.type="smartresize",v&&clearTimeout(v),v=setTimeout(function(){jQuery.event.handle.apply(n,i)},e==="execAsap"?0:100)}},e.fn.smartresize=function(t){return t?this.bind("smartresize",t):this.trigger("smartresize",["execAsap"])},e.Isotope=function(t,n,i){this.element=e(n),this._create(t),this._init(i)};var _=["width","height"],w=e(t);e.Isotope.settings={resizable:!0,layoutMode:"masonry",containerClass:"isotope",itemClass:"isotope-item",hiddenClass:"isotope-hidden",hiddenStyle:{opacity:0,scale:.001},visibleStyle:{opacity:1,scale:1},containerStyle:{position:"relative",overflow:"hidden"},animationEngine:"best-available",animationOptions:{queue:!1,duration:800},sortBy:"original-order",sortAscending:!0,resizesContainer:!0,transformsEnabled:!e.browser.opera,itemPositionDataEnabled:!1},e.Isotope.prototype={_create:function(t){this.options=e.extend({},e.Isotope.settings,t),this.styleQueue=[],this.elemCount=0;var n=this.element[0].style;this.originalStyle={};var i=_.slice(0);for(var r in this.options.containerStyle)i.push(r);for(var s=0,o=i.length;o>s;s++)r=i[s],this.originalStyle[r]=n[r]||"";this.element.css(this.options.containerStyle),this._updateAnimationEngine(),this._updateUsingTransforms();var a={"original-order":function(t,e){return e.elemCount++,e.elemCount},random:function(){return Math.random()}};this.options.getSortData=e.extend(this.options.getSortData,a),this.reloadItems(),this.offset={left:parseInt(this.element.css("padding-left")||0,10),top:parseInt(this.element.css("padding-top")||0,10)};var u=this;setTimeout(function(){u.element.addClass(u.options.containerClass)},0),this.options.resizable&&w.bind("smartresize.isotope",function(){u.resize()}),this.element.delegate("."+this.options.hiddenClass,"click",function(){return!1})},_getAtoms:function(t){var e=this.options.itemSelector,n=e?t.filter(e).add(t.find(e)):t,i={position:"absolute"};return this.usingTransforms&&(i.left=0,i.top=0),n.css(i).addClass(this.options.itemClass),this.updateSortData(n,!0),n},_init:function(t){this.$filteredAtoms=this._filter(this.$allAtoms),this._sort(),this.reLayout(t)},option:function(t){if(e.isPlainObject(t)){this.options=e.extend(!0,this.options,t);var n;for(var i in t)n="_update"+s(i),this[n]&&this[n]()}},_updateAnimationEngine:function(){var t,e=this.options.animationEngine.toLowerCase().replace(/[ _\-]/g,"");switch(e){case"css":case"none":t=!1;break;case"jquery":t=!0;break;default:t=!r.csstransitions}this.isUsingJQueryAnimation=t,this._updateUsingTransforms()},_updateTransformsEnabled:function(){this._updateUsingTransforms()},_updateUsingTransforms:function(){var t=this.usingTransforms=this.options.transformsEnabled&&r.csstransforms&&r.csstransitions&&!this.isUsingJQueryAnimation;t||(delete this.options.hiddenStyle.scale,delete this.options.visibleStyle.scale),this.getPositionStyles=t?this._translate:this._positionAbs},_filter:function(t){var e=this.options.filter===""?"*":this.options.filter;if(!e)return t;var n=this.options.hiddenClass,i="."+n,r=t.filter(i),s=r;if(e!=="*"){s=r.filter(e);var o=t.not(i).not(e).addClass(n);this.styleQueue.push({$el:o,style:this.options.hiddenStyle})}return this.styleQueue.push({$el:s,style:this.options.visibleStyle}),s.removeClass(n),t.filter(e)},updateSortData:function(t,n){var i,r,s=this,o=this.options.getSortData;t.each(function(){i=e(this),r={};for(var t in o)r[t]=n||t!=="original-order"?o[t](i,s):e.data(this,"isotope-sort-data")[t];e.data(this,"isotope-sort-data",r)})},_sort:function(){var t=this.options.sortBy,e=this._getSorter,n=this.options.sortAscending?1:-1,i=function(i,r){var s=e(i,t),o=e(r,t);return s===o&&t!=="original-order"&&(s=e(i,"original-order"),o=e(r,"original-order")),(s>o?1:o>s?-1:0)*n};this.$filteredAtoms.sort(i)},_getSorter:function(t,n){return e.data(t,"isotope-sort-data")[n]},_translate:function(t,e){return{translate:[t,e]}},_positionAbs:function(t,e){return{left:t,top:e}},_pushPosition:function(t,e,n){e=Math.round(e+this.offset.left),n=Math.round(n+this.offset.top);var i=this.getPositionStyles(e,n);this.styleQueue.push({$el:t,style:i}),this.options.itemPositionDataEnabled&&t.data("isotope-item-position",{x:e,y:n})},layout:function(t,e){var n=this.options.layoutMode;if(this["_"+n+"Layout"](t),this.options.resizesContainer){var i=this["_"+n+"GetContainerSize"]();this.styleQueue.push({$el:this.element,style:i})}this._processStyleQueue(t,e),this.isLaidOut=!0},_processStyleQueue:function(t,n){var i,s,o,a,u=this.isLaidOut?this.isUsingJQueryAnimation?"animate":"css":"css",l=this.options.animationOptions,h=this.options.onLayout;if(s=function(t,e){e.$el[u](e.style,l)},this._isInserting&&this.isUsingJQueryAnimation)s=function(t,e){i=e.$el.hasClass("no-transition")?"css":u,e.$el[i](e.style,l)};else if(n||h||l.complete){var c=!1,f=[n,h,l.complete],d=this;if(o=!0,a=function(){if(!c){for(var e,n=0,i=f.length;i>n;n++)e=f[n],typeof e=="function"&&e.call(d.element,t,d);c=!0}},this.isUsingJQueryAnimation&&u==="animate")l.complete=a,o=!1;else if(r.csstransitions){var p,v=0,y=this.styleQueue[0],_=y&&y.$el;while(!_||!_.length){if(p=this.styleQueue[v++],!p)return;_=p.$el}var w=parseFloat(getComputedStyle(_[0])[g]);w>0&&(s=function(t,e){e.$el[u](e.style,l).one(m,a)},o=!1)}}e.each(this.styleQueue,s),o&&a(),this.styleQueue=[]},resize:function(){this["_"+this.options.layoutMode+"ResizeChanged"]()&&this.reLayout()},reLayout:function(t){this["_"+this.options.layoutMode+"Reset"](),this.layout(this.$filteredAtoms,t)},addItems:function(t,e){var n=this._getAtoms(t);this.$allAtoms=this.$allAtoms.add(n),e&&e(n)},insert:function(t,e){this.element.append(t);var n=this;this.addItems(t,function(t){var i=n._filter(t);n._addHideAppended(i),n._sort(),n.reLayout(),n._revealAppended(i,e)})},appended:function(t,e){var n=this;this.addItems(t,function(t){n._addHideAppended(t),n.layout(t),n._revealAppended(t,e)})},_addHideAppended:function(t){this.$filteredAtoms=this.$filteredAtoms.add(t),t.addClass("no-transition"),this._isInserting=!0,this.styleQueue.push({$el:t,style:this.options.hiddenStyle})},_revealAppended:function(t,e){var n=this;setTimeout(function(){t.removeClass("no-transition"),n.styleQueue.push({$el:t,style:n.options.visibleStyle}),n._isInserting=!1,n._processStyleQueue(t,e)},10)},reloadItems:function(){this.$allAtoms=this._getAtoms(this.element.children())},remove:function(t,e){var n=this,i=function(){n.$allAtoms=n.$allAtoms.not(t),t.remove(),e&&e.call(this.element)};t.filter(":not(."+this.options.hiddenClass+")").length?(this.styleQueue.push({$el:t,style:this.options.hiddenStyle}),this.$filteredAtoms=this.$filteredAtoms.not(t),this._sort(),this.reLayout(i)):i()},shuffle:function(t){this.updateSortData(this.$allAtoms),this.options.sortBy="random",this._sort(),this.reLayout(t)},destroy:function(){var t=this.usingTransforms,e=this.options;this.$allAtoms.removeClass(e.hiddenClass+" "+e.itemClass).each(function(){var e=this.style;e.position="",e.top="",e.left="",e.opacity="",t&&(e[u]="")});var n=this.element[0].style;for(var i in this.originalStyle)n[i]=this.originalStyle[i];this.element.unbind(".isotope").undelegate("."+e.hiddenClass,"click").removeClass(e.containerClass).removeData("isotope"),w.unbind(".isotope")},_getSegments:function(t){var e,n=this.options.layoutMode,i=t?"rowHeight":"columnWidth",r=t?"height":"width",o=t?"rows":"cols",a=this.element[r](),u=this.options[n]&&this.options[n][i]||this.$filteredAtoms["outer"+s(r)](!0)||a;e=Math.floor(a/u),e=Math.max(e,1),this[n][o]=e,this[n][i]=u},_checkIfSegmentsChanged:function(t){var e=this.options.layoutMode,n=t?"rows":"cols",i=this[e][n];return this._getSegments(t),this[e][n]!==i},_masonryReset:function(){this.masonry={},this._getSegments();var t=this.masonry.cols;this.masonry.colYs=[];while(t--)this.masonry.colYs.push(0)},_masonryLayout:function(t){var n=this,i=n.masonry;t.each(function(){var t=e(this),r=Math.ceil(t.outerWidth(!0)/i.columnWidth);if(r=Math.min(r,i.cols),r===1)n._masonryPlaceBrick(t,i.colYs);else{var s,o,a=i.cols+1-r,u=[];for(o=0;a>o;o++)s=i.colYs.slice(o,o+r),u[o]=Math.max.apply(Math,s);n._masonryPlaceBrick(t,u)}})},_masonryPlaceBrick:function(t,e){for(var n=Math.min.apply(Math,e),i=0,r=0,s=e.length;s>r;r++)if(e[r]===n){i=r;break}var o=this.masonry.columnWidth*i,a=n;this._pushPosition(t,o,a);var u=n+t.outerHeight(!0),l=this.masonry.cols+1-s;for(r=0;l>r;r++)this.masonry.colYs[i+r]=u},_masonryGetContainerSize:function(){var t=Math.max.apply(Math,this.masonry.colYs);return{height:t}},_masonryResizeChanged:function(){return this._checkIfSegmentsChanged()},_fitRowsReset:function(){this.fitRows={x:0,y:0,height:0}},_fitRowsLayout:function(t){var n=this,i=this.element.width(),r=this.fitRows;t.each(function(){var t=e(this),s=t.outerWidth(!0),o=t.outerHeight(!0);r.x!==0&&s+r.x>i&&(r.x=0,r.y=r.height),n._pushPosition(t,r.x,r.y),r.height=Math.max(r.y+o,r.height),r.x+=s})},_fitRowsGetContainerSize:function(){return{height:this.fitRows.height}},_fitRowsResizeChanged:function(){return!0},_cellsByRowReset:function(){this.cellsByRow={index:0},this._getSegments(),this._getSegments(!0)},_cellsByRowLayout:function(t){var n=this,i=this.cellsByRow;t.each(function(){var t=e(this),r=i.index%i.cols,s=Math.floor(i.index/i.cols),o=(r+.5)*i.columnWidth-t.outerWidth(!0)/2,a=(s+.5)*i.rowHeight-t.outerHeight(!0)/2;n._pushPosition(t,o,a),i.index++})},_cellsByRowGetContainerSize:function(){return{height:Math.ceil(this.$filteredAtoms.length/this.cellsByRow.cols)*this.cellsByRow.rowHeight+this.offset.top}},_cellsByRowResizeChanged:function(){return this._checkIfSegmentsChanged()},_straightDownReset:function(){this.straightDown={y:0}},_straightDownLayout:function(t){var n=this;t.each(function(){var t=e(this);n._pushPosition(t,0,n.straightDown.y),n.straightDown.y+=t.outerHeight(!0)})},_straightDownGetContainerSize:function(){return{height:this.straightDown.y}},_straightDownResizeChanged:function(){return!0},_masonryHorizontalReset:function(){this.masonryHorizontal={},this._getSegments(!0);var t=this.masonryHorizontal.rows;this.masonryHorizontal.rowXs=[];while(t--)this.masonryHorizontal.rowXs.push(0)},_masonryHorizontalLayout:function(t){var n=this,i=n.masonryHorizontal;t.each(function(){var t=e(this),r=Math.ceil(t.outerHeight(!0)/i.rowHeight);if(r=Math.min(r,i.rows),r===1)n._masonryHorizontalPlaceBrick(t,i.rowXs);else{var s,o,a=i.rows+1-r,u=[];for(o=0;a>o;o++)s=i.rowXs.slice(o,o+r),u[o]=Math.max.apply(Math,s);n._masonryHorizontalPlaceBrick(t,u)}})},_masonryHorizontalPlaceBrick:function(t,e){for(var n=Math.min.apply(Math,e),i=0,r=0,s=e.length;s>r;r++)if(e[r]===n){i=r;break}var o=n,a=this.masonryHorizontal.rowHeight*i;this._pushPosition(t,o,a);var u=n+t.outerWidth(!0),l=this.masonryHorizontal.rows+1-s;for(r=0;l>r;r++)this.masonryHorizontal.rowXs[i+r]=u},_masonryHorizontalGetContainerSize:function(){var t=Math.max.apply(Math,this.masonryHorizontal.rowXs);return{width:t}},_masonryHorizontalResizeChanged:function(){return this._checkIfSegmentsChanged(!0)},_fitColumnsReset:function(){this.fitColumns={x:0,y:0,width:0}},_fitColumnsLayout:function(t){var n=this,i=this.element.height(),r=this.fitColumns;t.each(function(){var t=e(this),s=t.outerWidth(!0),o=t.outerHeight(!0);r.y!==0&&o+r.y>i&&(r.x=r.width,r.y=0),n._pushPosition(t,r.x,r.y),r.width=Math.max(r.x+s,r.width),r.y+=o})},_fitColumnsGetContainerSize:function(){return{width:this.fitColumns.width}},_fitColumnsResizeChanged:function(){return!0},_cellsByColumnReset:function(){this.cellsByColumn={index:0},this._getSegments(),this._getSegments(!0)},_cellsByColumnLayout:function(t){var n=this,i=this.cellsByColumn;t.each(function(){var t=e(this),r=Math.floor(i.index/i.rows),s=i.index%i.rows,o=(r+.5)*i.columnWidth-t.outerWidth(!0)/2,a=(s+.5)*i.rowHeight-t.outerHeight(!0)/2;n._pushPosition(t,o,a),i.index++})},_cellsByColumnGetContainerSize:function(){return{width:Math.ceil(this.$filteredAtoms.length/this.cellsByColumn.rows)*this.cellsByColumn.columnWidth}},_cellsByColumnResizeChanged:function(){return this._checkIfSegmentsChanged(!0)},_straightAcrossReset:function(){this.straightAcross={x:0}},_straightAcrossLayout:function(t){var n=this;t.each(function(){var t=e(this);n._pushPosition(t,n.straightAcross.x,0),n.straightAcross.x+=t.outerWidth(!0)})},_straightAcrossGetContainerSize:function(){return{width:this.straightAcross.x}},_straightAcrossResizeChanged:function(){return!0}},e.fn.imagesLoaded=function(t){function n(t){var r=t.target;r.src!==a&&e.inArray(r,u)===-1&&(u.push(r),0>=--o&&(setTimeout(i),s.unbind(".imagesLoaded",n)))}function i(){t.call(r,s)}var r=this,s=r.find("img").add(r.filter("img")),o=s.length,a="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",u=[];return o||i(),s.bind("load.imagesLoaded error.imagesLoaded",n).each(function(){var t=this.src;this.src=a,this.src=t}),r};var b=function(e){t.console&&t.console.error(e)};e.fn.isotope=function(t,n){if(typeof t=="string"){var i=Array.prototype.slice.call(arguments,1);this.each(function(){var n=e.data(this,"isotope");if(n){if(!e.isFunction(n[t])||t.charAt(0)==="_")return b("no such method '"+t+"' for isotope instance"),void 0;n[t].apply(n,i)}else b("cannot call methods on isotope prior to initialization; attempted to call method '"+t+"'")})}else this.each(function(){var i=e.data(this,"isotope");i?(i.option(t),i._init(n)):e.data(this,"isotope",new e.Isotope(t,this,n))});return this}})(window,jQuery),function(){var t=this,e=t._,n={},i=Array.prototype,r=Object.prototype,s=Function.prototype,o=i.push,a=i.slice,u=i.concat,l=(i.unshift,r.toString),h=r.hasOwnProperty,c=i.forEach,f=i.map,d=i.reduce,p=i.reduceRight,m=i.filter,g=i.every,v=i.some,y=i.indexOf,_=i.lastIndexOf,w=Array.isArray,b=Object.keys,x=s.bind,A=function(t){return t instanceof A?t:this instanceof A?(this._wrapped=t,void 0):new A(t)};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=A),exports._=A):t._=A,A.VERSION="1.4.2";var k=A.each=A.forEach=function(t,e,i){if(t!=null)if(c&&t.forEach===c)t.forEach(e,i);else if(t.length===+t.length){for(var r=0,s=t.length;s>r;r++)if(e.call(i,t[r],r,t)===n)return}else for(var o in t)if(A.has(t,o)&&e.call(i,t[o],o,t)===n)return};A.map=A.collect=function(t,e,n){var i=[];return t==null?i:f&&t.map===f?t.map(e,n):(k(t,function(t,r,s){i[i.length]=e.call(n,t,r,s)}),i)},A.reduce=A.foldl=A.inject=function(t,e,n,i){var r=arguments.length>2;if(t==null&&(t=[]),d&&t.reduce===d)return i&&(e=A.bind(e,i)),r?t.reduce(e,n):t.reduce(e);if(k(t,function(t,s,o){r?n=e.call(i,n,t,s,o):(n=t,r=!0)}),!r)throw new TypeError("Reduce of empty array with no initial value");return n},A.reduceRight=A.foldr=function(t,e,n,i){var r=arguments.length>2;if(t==null&&(t=[]),p&&t.reduceRight===p)return i&&(e=A.bind(e,i)),arguments.length>2?t.reduceRight(e,n):t.reduceRight(e);var s=t.length;if(s!==+s){var o=A.keys(t);s=o.length}if(k(t,function(a,u,l){u=o?o[--s]:--s,r?n=e.call(i,n,t[u],u,l):(n=t[u],r=!0)}),!r)throw new TypeError("Reduce of empty array with no initial value");return n},A.find=A.detect=function(t,e,n){var i;return S(t,function(t,r,s){return e.call(n,t,r,s)?(i=t,!0):void 0}),i},A.filter=A.select=function(t,e,n){var i=[];return t==null?i:m&&t.filter===m?t.filter(e,n):(k(t,function(t,r,s){e.call(n,t,r,s)&&(i[i.length]=t)}),i)},A.reject=function(t,e,n){var i=[];return t==null?i:(k(t,function(t,r,s){e.call(n,t,r,s)||(i[i.length]=t)}),i)},A.every=A.all=function(t,e,i){e||(e=A.identity);var r=!0;return t==null?r:g&&t.every===g?t.every(e,i):(k(t,function(t,s,o){return(r=r&&e.call(i,t,s,o))?void 0:n}),!!r)};var S=A.some=A.any=function(t,e,i){e||(e=A.identity);var r=!1;return t==null?r:v&&t.some===v?t.some(e,i):(k(t,function(t,s,o){return r||(r=e.call(i,t,s,o))?n:void 0}),!!r)};A.contains=A.include=function(t,e){var n=!1;return t==null?n:y&&t.indexOf===y?t.indexOf(e)!=-1:n=S(t,function(t){return t===e})},A.invoke=function(t,e){var n=a.call(arguments,2);return A.map(t,function(t){return(A.isFunction(e)?e:t[e]).apply(t,n)})},A.pluck=function(t,e){return A.map(t,function(t){return t[e]})},A.where=function(t,e){return A.isEmpty(e)?[]:A.filter(t,function(t){for(var n in e)if(e[n]!==t[n])return!1;return!0})},A.max=function(t,e,n){if(!e&&A.isArray(t)&&t[0]===+t[0]&&65535>t.length)return Math.max.apply(Math,t);if(!e&&A.isEmpty(t))return-1/0;var i={computed:-1/0};return k(t,function(t,r,s){var o=e?e.call(n,t,r,s):t;o>=i.computed&&(i={value:t,computed:o})}),i.value},A.min=function(t,e,n){if(!e&&A.isArray(t)&&t[0]===+t[0]&&65535>t.length)return Math.min.apply(Math,t);if(!e&&A.isEmpty(t))return 1/0;var i={computed:1/0};return k(t,function(t,r,s){var o=e?e.call(n,t,r,s):t;i.computed>o&&(i={value:t,computed:o})}),i.value},A.shuffle=function(t){var e,n=0,i=[];return k(t,function(t){e=A.random(n++),i[n-1]=i[e],i[e]=t}),i};var C=function(t){return A.isFunction(t)?t:function(e){return e[t]}};A.sortBy=function(t,e,n){var i=C(e);return A.pluck(A.map(t,function(t,e,r){return{value:t,index:e,criteria:i.call(n,t,e,r)}}).sort(function(t,e){var n=t.criteria,i=e.criteria;if(n!==i){if(n>i||n===void 0)return 1;if(i>n||i===void 0)return-1}return e.index>t.index?-1:1}),"value")};var E=function(t,e,n,i){var r={},s=C(e);return k(t,function(e,o){var a=s.call(n,e,o,t);i(r,a,e)}),r};A.groupBy=function(t,e,n){return E(t,e,n,function(t,e,n){(A.has(t,e)?t[e]:t[e]=[]).push(n)})},A.countBy=function(t,e,n){return E(t,e,n,function(t,e){A.has(t,e)||(t[e]=0),t[e]++})},A.sortedIndex=function(t,e,n,i){n=n==null?A.identity:C(n);var r=n.call(i,e),s=0,o=t.length;while(o>s){var a=s+o>>>1;r>n.call(i,t[a])?s=a+1:o=a}return s},A.toArray=function(t){return t?t.length===+t.length?a.call(t):A.values(t):[]},A.size=function(t){return t.length===+t.length?t.length:A.keys(t).length},A.first=A.head=A.take=function(t,e,n){return e==null||n?t[0]:a.call(t,0,e)},A.initial=function(t,e,n){return a.call(t,0,t.length-(e==null||n?1:e))},A.last=function(t,e,n){return e==null||n?t[t.length-1]:a.call(t,Math.max(t.length-e,0))},A.rest=A.tail=A.drop=function(t,e,n){return a.call(t,e==null||n?1:e)},A.compact=function(t){return A.filter(t,function(t){return!!t})};var z=function(t,e,n){return k(t,function(t){A.isArray(t)?e?o.apply(n,t):z(t,e,n):n.push(t)}),n};A.flatten=function(t,e){return z(t,e,[])},A.without=function(t){return A.difference(t,a.call(arguments,1))},A.uniq=A.unique=function(t,e,n,i){var r=n?A.map(t,n,i):t,s=[],o=[];return k(r,function(n,i){(e?i&&o[o.length-1]===n:A.contains(o,n))||(o.push(n),s.push(t[i]))}),s},A.union=function(){return A.uniq(u.apply(i,arguments))},A.intersection=function(t){var e=a.call(arguments,1);return A.filter(A.uniq(t),function(t){return A.every(e,function(e){return A.indexOf(e,t)>=0})})},A.difference=function(t){var e=u.apply(i,a.call(arguments,1));return A.filter(t,function(t){return!A.contains(e,t)})},A.zip=function(){for(var t=a.call(arguments),e=A.max(A.pluck(t,"length")),n=Array(e),i=0;e>i;i++)n[i]=A.pluck(t,""+i);return n},A.object=function(t,e){for(var n={},i=0,r=t.length;r>i;i++)e?n[t[i]]=e[i]:n[t[i][0]]=t[i][1];return n},A.indexOf=function(t,e,n){if(t==null)return-1;var i=0,r=t.length;if(n){if(typeof n!="number")return i=A.sortedIndex(t,e),t[i]===e?i:-1;i=0>n?Math.max(0,r+n):n}if(y&&t.indexOf===y)return t.indexOf(e,n);for(;r>i;i++)if(t[i]===e)return i;return-1},A.lastIndexOf=function(t,e,n){if(t==null)return-1;var i=n!=null;if(_&&t.lastIndexOf===_)return i?t.lastIndexOf(e,n):t.lastIndexOf(e);var r=i?n:t.length;while(r--)if(t[r]===e)return r;return-1},A.range=function(t,e,n){1>=arguments.length&&(e=t||0,t=0),n=arguments[2]||1;var i=Math.max(Math.ceil((e-t)/n),0),r=0,s=Array(i);while(i>r)s[r++]=t,t+=n;return s};var T=function(){};A.bind=function(t,e){var n,i;if(t.bind===x&&x)return x.apply(t,a.call(arguments,1));if(!A.isFunction(t))throw new TypeError;return i=a.call(arguments,2),n=function(){if(this instanceof n){T.prototype=t.prototype;var r=new T,s=t.apply(r,i.concat(a.call(arguments)));return Object(s)===s?s:r}return t.apply(e,i.concat(a.call(arguments)))}},A.bindAll=function(t){var e=a.call(arguments,1);return e.length==0&&(e=A.functions(t)),k(e,function(e){t[e]=A.bind(t[e],t)}),t},A.memoize=function(t,e){var n={};return e||(e=A.identity),function(){var i=e.apply(this,arguments);return A.has(n,i)?n[i]:n[i]=t.apply(this,arguments)}},A.delay=function(t,e){var n=a.call(arguments,2);return setTimeout(function(){return t.apply(null,n)},e)},A.defer=function(t){return A.delay.apply(A,[t,1].concat(a.call(arguments,1)))},A.throttle=function(t,e){var n,i,r,s,o,a,u=A.debounce(function(){o=s=!1},e);return function(){n=this,i=arguments;var l=function(){r=null,o&&(a=t.apply(n,i)),u()};return r||(r=setTimeout(l,e)),s?o=!0:(s=!0,a=t.apply(n,i)),u(),a}},A.debounce=function(t,e,n){var i,r;return function(){var s=this,o=arguments,a=function(){i=null,n||(r=t.apply(s,o))},u=n&&!i;return clearTimeout(i),i=setTimeout(a,e),u&&(r=t.apply(s,o)),r}},A.once=function(t){var e,n=!1;return function(){return n?e:(n=!0,e=t.apply(this,arguments),t=null,e)}},A.wrap=function(t,e){return function(){var n=[t];return o.apply(n,arguments),e.apply(this,n)}},A.compose=function(){var t=arguments;return function(){for(var e=arguments,n=t.length-1;n>=0;n--)e=[t[n].apply(this,e)];return e[0]}},A.after=function(t,e){return t>0?function(){return 1>--t?e.apply(this,arguments):void 0}:e()},A.keys=b||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var n in t)A.has(t,n)&&(e[e.length]=n);return e},A.values=function(t){var e=[];for(var n in t)A.has(t,n)&&e.push(t[n]);return e},A.pairs=function(t){var e=[];for(var n in t)A.has(t,n)&&e.push([n,t[n]]);return e},A.invert=function(t){var e={};for(var n in t)A.has(t,n)&&(e[t[n]]=n);return e},A.functions=A.methods=function(t){var e=[];for(var n in t)A.isFunction(t[n])&&e.push(n);return e.sort()},A.extend=function(t){return k(a.call(arguments,1),function(e){for(var n in e)t[n]=e[n]}),t},A.pick=function(t){var e={},n=u.apply(i,a.call(arguments,1));return k(n,function(n){n in t&&(e[n]=t[n])}),e},A.omit=function(t){var e={},n=u.apply(i,a.call(arguments,1));for(var r in t)A.contains(n,r)||(e[r]=t[r]);return e},A.defaults=function(t){return k(a.call(arguments,1),function(e){for(var n in e)t[n]==null&&(t[n]=e[n])}),t},A.clone=function(t){return A.isObject(t)?A.isArray(t)?t.slice():A.extend({},t):t},A.tap=function(t,e){return e(t),t};var R=function(t,e,n,i){if(t===e)return t!==0||1/t==1/e;if(t==null||e==null)return t===e;t instanceof A&&(t=t._wrapped),e instanceof A&&(e=e._wrapped);var r=l.call(t);if(r!=l.call(e))return!1;switch(r){case"[object String]":return t==e+"";case"[object Number]":return t!=+t?e!=+e:t==0?1/t==1/e:t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object RegExp]":return t.source==e.source&&t.global==e.global&&t.multiline==e.multiline&&t.ignoreCase==e.ignoreCase}if(typeof t!="object"||typeof e!="object")return!1;var s=n.length;while(s--)if(n[s]==t)return i[s]==e;n.push(t),i.push(e);var o=0,a=!0;if(r=="[object Array]"){if(o=t.length,a=o==e.length)while(o--)if(!(a=R(t[o],e[o],n,i)))break}else{var u=t.constructor,h=e.constructor;if(u!==h&&!(A.isFunction(u)&&u instanceof u&&A.isFunction(h)&&h instanceof h))return!1;for(var c in t)if(A.has(t,c)&&(o++,!(a=A.has(e,c)&&R(t[c],e[c],n,i))))break;if(a){for(c in e)if(A.has(e,c)&&!o--)break;a=!o}}return n.pop(),i.pop(),a};A.isEqual=function(t,e){return R(t,e,[],[])},A.isEmpty=function(t){if(t==null)return!0;if(A.isArray(t)||A.isString(t))return t.length===0;for(var e in t)if(A.has(t,e))return!1;return!0},A.isElement=function(t){return!!t&&t.nodeType===1},A.isArray=w||function(t){return l.call(t)=="[object Array]"},A.isObject=function(t){return t===Object(t)},k(["Arguments","Function","String","Number","Date","RegExp"],function(t){A["is"+t]=function(e){return l.call(e)=="[object "+t+"]"}}),A.isArguments(arguments)||(A.isArguments=function(t){return!!t&&!!A.has(t,"callee")}),true&&(A.isFunction=function(t){return typeof t=="function"}),A.isFinite=function(t){return A.isNumber(t)&&isFinite(t)},A.isNaN=function(t){return A.isNumber(t)&&t!=+t},A.isBoolean=function(t){return t===!0||t===!1||l.call(t)=="[object Boolean]"},A.isNull=function(t){return t===null},A.isUndefined=function(t){return t===void 0},A.has=function(t,e){return h.call(t,e)},A.noConflict=function(){return t._=e,this},A.identity=function(t){return t},A.times=function(t,e,n){for(var i=0;t>i;i++)e.call(n,i)},A.random=function(t,e){return e==null&&(e=t,t=0),t+(0|Math.random()*(e-t+1))};var $={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};$.unescape=A.invert($.escape);var B={escape:RegExp("["+A.keys($.escape).join("")+"]","g"),unescape:RegExp("("+A.keys($.unescape).join("|")+")","g")};A.each(["escape","unescape"],function(t){A[t]=function(e){return e==null?"":(""+e).replace(B[t],function(e){return $[t][e]})}}),A.result=function(t,e){if(t==null)return null;var n=t[e];return A.isFunction(n)?n.call(t):n},A.mixin=function(t){k(A.functions(t),function(e){var n=A[e]=t[e];A.prototype[e]=function(){var t=[this._wrapped];return o.apply(t,arguments),O.call(this,n.apply(A,t))}})};var I=0;A.uniqueId=function(t){var e=I++;return t?t+e:e},A.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var M=/(.)^/,P={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},H=/\\|'|\r|\n|\t|\u2028|\u2029/g;A.template=function(t,e,n){n=A.defaults({},n,A.templateSettings);var i=RegExp([(n.escape||M).source,(n.interpolate||M).source,(n.evaluate||M).source].join("|")+"|$","g"),r=0,s="__p+='";t.replace(i,function(e,n,i,o,a){s+=t.slice(r,a).replace(H,function(t){return"\\"+P[t]}),s+=n?"'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":i?"'+\n((__t=("+i+"))==null?'':__t)+\n'":o?"';\n"+o+"\n__p+='":"",r=a+e.length}),s+="';\n",n.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{var o=Function(n.variable||"obj","_",s)}catch(a){throw a.source=s,a}if(e)return o(e,A);var u=function(t){return o.call(this,t,A)};return u.source="function("+(n.variable||"obj")+"){\n"+s+"}",u},A.chain=function(t){return A(t).chain()};var O=function(t){return this._chain?A(t).chain():t};A.mixin(A),k(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=i[t];A.prototype[t]=function(){var n=this._wrapped;return e.apply(n,arguments),(t=="shift"||t=="splice")&&n.length===0&&delete n[0],O.call(this,n)}}),k(["concat","join","slice"],function(t){var e=i[t];A.prototype[t]=function(){return O.call(this,e.apply(this._wrapped,arguments))}}),A.extend(A.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),function(){var t,e=this,n=e.Backbone,i=Array.prototype.slice,r=Array.prototype.splice;t="undefined"!=typeof exports?exports:e.Backbone={},t.VERSION="0.9.2";var s=e._;!s&&"undefined"!=typeof require&&(s=require("underscore"));var o=e.jQuery||e.Zepto||e.ender;t.setDomLibrary=function(t){o=t},t.noConflict=function(){return e.Backbone=n,this},t.emulateHTTP=!1,t.emulateJSON=!1;var a=/\s+/,u=t.Events={on:function(t,e,n){var i,r,s,o,u;if(!e)return this;for(t=t.split(a),i=this._callbacks||(this._callbacks={});r=t.shift();)s=(u=i[r])?u.tail:{},s.next=o={},s.context=n,s.callback=e,i[r]={tail:o,next:u?u.next:s};return this},off:function(t,e,n){var i,r,o,u,l,h;if(r=this._callbacks){if(!t&&!e&&!n)return delete this._callbacks,this;for(t=t?t.split(a):s.keys(r);i=t.shift();)if(o=r[i],delete r[i],o&&(e||n))for(u=o.tail;(o=o.next)!==u;)(l=o.callback,h=o.context,e&&l!==e||n&&h!==n)&&this.on(i,l,h);return this}},trigger:function(t){var e,n,r,s,o,u;if(!(r=this._callbacks))return this;for(o=r.all,t=t.split(a),u=i.call(arguments,1);e=t.shift();){if(n=r[e])for(s=n.tail;(n=n.next)!==s;)n.callback.apply(n.context||this,u);if(n=o)for(s=n.tail,e=[e].concat(u);(n=n.next)!==s;)n.callback.apply(n.context||this,e)}return this}};u.bind=u.on,u.unbind=u.off;var l=t.Model=function(t,e){var n;t||(t={}),e&&e.parse&&(t=this.parse(t)),(n=k(this,"defaults"))&&(t=s.extend({},n,t)),e&&e.collection&&(this.collection=e.collection),this.attributes={},this._escapedAttributes={},this.cid=s.uniqueId("c"),this.changed={},this._silent={},this._pending={},this.set(t,{silent:!0}),this.changed={},this._silent={},this._pending={},this._previousAttributes=s.clone(this.attributes),this.initialize.apply(this,arguments)};s.extend(l.prototype,u,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(){return s.clone(this.attributes)},get:function(t){return this.attributes[t]},escape:function(t){var e;return(e=this._escapedAttributes[t])?e:(e=this.get(t),this._escapedAttributes[t]=s.escape(null==e?"":""+e))},has:function(t){return null!=this.get(t)},set:function(t,e,n){var i,r;if(s.isObject(t)||null==t?(i=t,n=e):(i={},i[t]=e),n||(n={}),!i)return this;if(i instanceof l&&(i=i.attributes),n.unset)for(r in i)i[r]=void 0;if(!this._validate(i,n))return!1;this.idAttribute in i&&(this.id=i[this.idAttribute]);var e=n.changes={},o=this.attributes,a=this._escapedAttributes,u=this._previousAttributes||{};for(r in i)t=i[r],(!s.isEqual(o[r],t)||n.unset&&s.has(o,r))&&(delete a[r],(n.silent?this._silent:e)[r]=!0),n.unset?delete o[r]:o[r]=t,s.isEqual(u[r],t)&&s.has(o,r)==s.has(u,r)?(delete this.changed[r],delete this._pending[r]):(this.changed[r]=t,n.silent||(this._pending[r]=!0));return n.silent||this.change(n),this},unset:function(t,e){return(e||(e={})).unset=!0,this.set(t,null,e)},clear:function(t){return(t||(t={})).unset=!0,this.set(s.clone(this.attributes),t)},fetch:function(e){var e=e?s.clone(e):{},n=this,i=e.success;return e.success=function(t,r,s){return n.set(n.parse(t,s),e)?(i&&i(n,t),void 0):!1},e.error=t.wrapError(e.error,n,e),(this.sync||t.sync).call(this,"read",this,e)
},save:function(e,n,i){var r,o;if(s.isObject(e)||null==e?(r=e,i=n):(r={},r[e]=n),i=i?s.clone(i):{},i.wait){if(!this._validate(r,i))return!1;o=s.clone(this.attributes)}if(e=s.extend({},i,{silent:!0}),r&&!this.set(r,i.wait?e:i))return!1;var a=this,u=i.success;return i.success=function(t,e,n){return e=a.parse(t,n),i.wait&&(delete i.wait,e=s.extend(r||{},e)),a.set(e,i)?(u?u(a,t):a.trigger("sync",a,t,i),void 0):!1},i.error=t.wrapError(i.error,a,i),n=this.isNew()?"create":"update",n=(this.sync||t.sync).call(this,n,this,i),i.wait&&this.set(o,e),n},destroy:function(e){var e=e?s.clone(e):{},n=this,i=e.success,r=function(){n.trigger("destroy",n,n.collection,e)};if(this.isNew())return r(),!1;e.success=function(t){e.wait&&r(),i?i(n,t):n.trigger("sync",n,t,e)},e.error=t.wrapError(e.error,n,e);var o=(this.sync||t.sync).call(this,"delete",this,e);return e.wait||r(),o},url:function(){var t=k(this,"urlRoot")||k(this.collection,"url")||S();return this.isNew()?t:t+("/"==t.charAt(t.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(t){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},change:function(t){t||(t={});var e=this._changing;this._changing=!0;for(var n in this._silent)this._pending[n]=!0;var i=s.extend({},t.changes,this._silent);this._silent={};for(n in i)this.trigger("change:"+n,this,this.get(n),t);if(e)return this;for(;!s.isEmpty(this._pending);){this._pending={},this.trigger("change",this,t);for(n in this.changed)!this._pending[n]&&!this._silent[n]&&delete this.changed[n];this._previousAttributes=s.clone(this.attributes)}return this._changing=!1,this},hasChanged:function(t){return arguments.length?s.has(this.changed,t):!s.isEmpty(this.changed)},changedAttributes:function(t){if(!t)return this.hasChanged()?s.clone(this.changed):!1;var e,n,i=!1,r=this._previousAttributes;for(n in t)s.isEqual(r[n],e=t[n])||((i||(i={}))[n]=e);return i},previous:function(t){return arguments.length&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return s.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},_validate:function(t,e){if(e.silent||!this.validate)return!0;var t=s.extend({},this.attributes,t),n=this.validate(t,e);return n?(e&&e.error?e.error(this,n,e):this.trigger("error",this,n,e),!1):!0}});var h=t.Collection=function(t,e){e||(e={}),e.model&&(this.model=e.model),e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,{silent:!0,parse:e.parse})};s.extend(h.prototype,u,{model:l,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},add:function(t,e){var n,i,o,a,u,l={},h={},c=[];for(e||(e={}),t=s.isArray(t)?t.slice():[t],n=0,i=t.length;i>n;n++){if(!(o=t[n]=this._prepareModel(t[n],e)))throw Error("Can't add an invalid model to a collection");a=o.cid,u=o.id,l[a]||this._byCid[a]||null!=u&&(h[u]||this._byId[u])?c.push(n):l[a]=h[u]=o}for(n=c.length;n--;)t.splice(c[n],1);for(n=0,i=t.length;i>n;n++)(o=t[n]).on("all",this._onModelEvent,this),this._byCid[o.cid]=o,null!=o.id&&(this._byId[o.id]=o);if(this.length+=i,r.apply(this.models,[null!=e.at?e.at:this.models.length,0].concat(t)),this.comparator&&this.sort({silent:!0}),e.silent)return this;for(n=0,i=this.models.length;i>n;n++)l[(o=this.models[n]).cid]&&(e.index=n,o.trigger("add",o,this,e));return this},remove:function(t,e){var n,i,r,o;for(e||(e={}),t=s.isArray(t)?t.slice():[t],n=0,i=t.length;i>n;n++)(o=this.getByCid(t[n])||this.get(t[n]))&&(delete this._byId[o.id],delete this._byCid[o.cid],r=this.indexOf(o),this.models.splice(r,1),this.length--,e.silent||(e.index=r,o.trigger("remove",o,this,e)),this._removeReference(o));return this},push:function(t,e){return t=this._prepareModel(t,e),this.add(t,e),t},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t),e},unshift:function(t,e){return t=this._prepareModel(t,e),this.add(t,s.extend({at:0},e)),t},shift:function(t){var e=this.at(0);return this.remove(e,t),e},get:function(t){return null==t?void 0:this._byId[null!=t.id?t.id:t]},getByCid:function(t){return t&&this._byCid[t.cid||t]},at:function(t){return this.models[t]},where:function(t){return s.isEmpty(t)?[]:this.filter(function(e){for(var n in t)if(t[n]!==e.get(n))return!1;return!0})},sort:function(t){if(t||(t={}),!this.comparator)throw Error("Cannot sort a set without a comparator");var e=s.bind(this.comparator,this);return 1==this.comparator.length?this.models=this.sortBy(e):this.models.sort(e),t.silent||this.trigger("reset",this,t),this},pluck:function(t){return s.map(this.models,function(e){return e.get(t)})},reset:function(t,e){t||(t=[]),e||(e={});for(var n=0,i=this.models.length;i>n;n++)this._removeReference(this.models[n]);return this._reset(),this.add(t,s.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),this},fetch:function(e){e=e?s.clone(e):{},void 0===e.parse&&(e.parse=!0);var n=this,i=e.success;return e.success=function(t,r,s){n[e.add?"add":"reset"](n.parse(t,s),e),i&&i(n,t)},e.error=t.wrapError(e.error,n,e),(this.sync||t.sync).call(this,"read",this,e)},create:function(t,e){var n=this,e=e?s.clone(e):{},t=this._prepareModel(t,e);if(!t)return!1;e.wait||n.add(t,e);var i=e.success;return e.success=function(r,s){e.wait&&n.add(r,e),i?i(r,s):r.trigger("sync",t,s,e)},t.save(null,e),t},parse:function(t){return t},chain:function(){return s(this.models).chain()},_reset:function(){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(t,e){return e||(e={}),t instanceof l?t.collection||(t.collection=this):(e.collection=this,t=new this.model(t,e),t._validate(t.attributes,e)||(t=!1)),t},_removeReference:function(t){this==t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,n,i){("add"==t||"remove"==t)&&n!=this||("destroy"==t&&this.remove(e,i),e&&t==="change:"+e.idAttribute&&(delete this._byId[e.previous(e.idAttribute)],this._byId[e.id]=e),this.trigger.apply(this,arguments))}}),s.each("forEach,each,map,reduce,reduceRight,find,detect,filter,select,reject,every,all,some,any,include,contains,invoke,max,min,sortBy,sortedIndex,toArray,size,first,initial,rest,last,without,indexOf,shuffle,lastIndexOf,isEmpty,groupBy".split(","),function(t){h.prototype[t]=function(){return s[t].apply(s,[this.models].concat(s.toArray(arguments)))}});var c=t.Router=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},f=/:\w+/g,d=/\*\w+/g,p=/[-[\]{}()+?.,\\^$|#\s]/g;s.extend(c.prototype,u,{initialize:function(){},route:function(e,n,i){return t.history||(t.history=new m),s.isRegExp(e)||(e=this._routeToRegExp(e)),i||(i=this[n]),t.history.route(e,s.bind(function(r){r=this._extractParameters(e,r),i&&i.apply(this,r),this.trigger.apply(this,["route:"+n].concat(r)),t.history.trigger("route",this,n,r)},this)),this},navigate:function(e,n){t.history.navigate(e,n)},_bindRoutes:function(){if(this.routes){var t,e=[];for(t in this.routes)e.unshift([t,this.routes[t]]);t=0;for(var n=e.length;n>t;t++)this.route(e[t][0],e[t][1],this[e[t][1]])}},_routeToRegExp:function(t){return t=t.replace(p,"\\$&").replace(f,"([^/]+)").replace(d,"(.*?)"),RegExp("^"+t+"$")},_extractParameters:function(t,e){return t.exec(e).slice(1)}});var m=t.History=function(){this.handlers=[],s.bindAll(this,"checkUrl")},g=/^[#\/]/,v=/msie [\w.]+/;m.started=!1,s.extend(m.prototype,u,{interval:50,getHash:function(t){return(t=(t?t.location:window.location).href.match(/#(.*)$/))?t[1]:""},getFragment:function(t,e){if(null==t)if(this._hasPushState||e){var t=window.location.pathname,n=window.location.search;n&&(t+=n)}else t=this.getHash();return t.indexOf(this.options.root)||(t=t.substr(this.options.root.length)),t.replace(g,"")},start:function(t){if(m.started)throw Error("Backbone.history has already been started");m.started=!0,this.options=s.extend({},{root:"/"},this.options,t),this._wantsHashChange=!1!==this.options.hashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=this.options.pushState&&window.history&&window.history.pushState;var t=this.getFragment(),e=document.documentMode;return(e=v.exec(navigator.userAgent.toLowerCase())&&(!e||7>=e))&&(this.iframe=o('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(t)),this._hasPushState?o(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!e?o(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=t,t=window.location,e=t.pathname==this.options.root,this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!e?(this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&e&&t.hash&&(this.fragment=this.getHash().replace(g,""),window.history.replaceState({},document.title,t.protocol+"//"+t.host+this.options.root+this.fragment)),this.options.silent?void 0:this.loadUrl())},stop:function(){o(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),m.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(){var t=this.getFragment();return t==this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe))),t==this.fragment?!1:(this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(this.getHash()),void 0)},loadUrl:function(t){var e=this.fragment=this.getFragment(t);return s.any(this.handlers,function(t){return t.route.test(e)?(t.callback(e),!0):void 0})},navigate:function(t,e){if(!m.started)return!1;e&&!0!==e||(e={trigger:e});var n=(t||"").replace(g,"");this.fragment!=n&&(this._hasPushState?(0!=n.indexOf(this.options.root)&&(n=this.options.root+n),this.fragment=n,window.history[e.replace?"replaceState":"pushState"]({},document.title,n)):this._wantsHashChange?(this.fragment=n,this._updateHash(window.location,n,e.replace),this.iframe&&n!=this.getFragment(this.getHash(this.iframe))&&(e.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,n,e.replace))):window.location.assign(this.options.root+t),e.trigger&&this.loadUrl(t))},_updateHash:function(t,e,n){n?t.replace((t+"").replace(/(javascript:|#).*$/,"")+"#"+e):t.hash=e}});var y=t.View=function(t){this.cid=s.uniqueId("view"),this._configure(t||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},_=/^(\S+)\s*(.*)$/,w="model,collection,el,id,attributes,className,tagName".split(",");s.extend(y.prototype,u,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this},make:function(t,e,n){return t=document.createElement(t),e&&o(t).attr(e),n&&o(t).html(n),t},setElement:function(t,e){return this.$el&&this.undelegateEvents(),this.$el=t instanceof o?t:o(t),this.el=this.$el[0],!1!==e&&this.delegateEvents(),this},delegateEvents:function(t){if(t||(t=k(this,"events"))){this.undelegateEvents();for(var e in t){var n=t[e];if(s.isFunction(n)||(n=this[t[e]]),!n)throw Error('Method "'+t[e]+'" does not exist');var i=e.match(_),r=i[1],i=i[2],n=s.bind(n,this),r=r+(".delegateEvents"+this.cid);""===i?this.$el.bind(r,n):this.$el.delegate(i,r,n)}}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(t){this.options&&(t=s.extend({},this.options,t));for(var e=0,n=w.length;n>e;e++){var i=w[e];t[i]&&(this[i]=t[i])}this.options=t},_ensureElement:function(){if(this.el)this.setElement(this.el,!1);else{var t=k(this,"attributes")||{};this.id&&(t.id=this.id),this.className&&(t["class"]=this.className),this.setElement(this.make(this.tagName,t),!1)}}}),l.extend=h.extend=c.extend=y.extend=function(t,e){var n=A(this,t,e);return n.extend=this.extend,n};var b={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};t.sync=function(e,n,i){var r=b[e];i||(i={});var a={type:r,dataType:"json"};return i.url||(a.url=k(n,"url")||S()),i.data||!n||"create"!=e&&"update"!=e||(a.contentType="application/json",a.data=JSON.stringify(n.toJSON())),t.emulateJSON&&(a.contentType="application/x-www-form-urlencoded",a.data=a.data?{model:a.data}:{}),!t.emulateHTTP||"PUT"!==r&&"DELETE"!==r||(t.emulateJSON&&(a.data._method=r),a.type="POST",a.beforeSend=function(t){t.setRequestHeader("X-HTTP-Method-Override",r)}),"GET"!==a.type&&!t.emulateJSON&&(a.processData=!1),o.ajax(s.extend(a,i))},t.wrapError=function(t,e,n){return function(i,r){r=i===e?r:i,t?t(e,r,n):e.trigger("error",e,r,n)}};var x=function(){},A=function(t,e,n){var i;return i=e&&e.hasOwnProperty("constructor")?e.constructor:function(){t.apply(this,arguments)},s.extend(i,t),x.prototype=t.prototype,i.prototype=new x,e&&s.extend(i.prototype,e),n&&s.extend(i,n),i.prototype.constructor=i,i.__super__=t.prototype,i},k=function(t,e){return t&&t[e]?s.isFunction(t[e])?t[e]():t[e]:null},S=function(){throw Error('A "url" property or function must be specified')}}.call(this);var app={collections:{},models:{},views:{}};app.models.Event=Backbone.Model.extend({urlRoot:"http://api.gignal.com/event/api/eventId/",idAttribute:"event_id"}),app.models.Text=Backbone.Model.extend({idAttribute:"text_stream_id"}),app.models.Photo=Backbone.Model.extend({idAttribute:"photo_stream_id"}),app.collections.Stream=Backbone.Collection.extend({calling:!1,parameters:{cid:0,limit:20,sinceTimeText:0,sinceTimePhoto:0},initialize:function(){this.update(),this.setIntervalUpdate()},url:function(){return app.event.urlRoot+app.event.get("id")},comparator:function(t){return t.get("created_on")},parse:function(t){var e=this;app.event.set(t.event);var n=[];return _.each(t.text,function(t){var i=e.get(t.text_stream_id);if(i===void 0){i=new app.models.Text(t),n.push(i);var r=new app.views.TextBox({model:i});app.view.$el.prepend(r.render().el).isotope("reloadItems").isotope({sortBy:"original-order"}),i.get("saved_on")>e.parameters.sinceTimeText&&(e.parameters.sinceTimeText=i.get("saved_on"))}}),_.each(t.photos,function(t){var i=e.get(t.photo_stream_id);if(i===void 0){i=new app.models.Photo(t),n.push(i);var r=new app.views.PhotoBox({model:i});app.view.$el.prepend(r.render().el).isotope("reloadItems").isotope({sortBy:"original-order"}),i.get("saved_on")>e.parameters.sinceTimePhoto&&(e.parameters.sinceTimePhoto=i.get("saved_on"))}}),n.length===0?[]:(app.view.refresh(),this.parameters.cid=0,n)},update:function(){var t=this;this.calling||(this.calling=!0,this.fetch({add:!0,cache:!0,timeout:1e4,data:{limit:this.parameters.limit,sinceIdPhoto:this.parameters.sinceIdPhoto,sinceIdText:this.parameters.sinceIdText,cid:this.parameters.cid++},success:function(){t.calling=!1},error:function(){t.calling=!1}}))},setIntervalUpdate:function(){this.intervalID=window.setInterval(function(){app.stream.update()},4500)}}),app.views.Event=Backbone.View.extend({el:"#gignal-stream",columnWidth:250,isotoptions:{itemSelector:".gignal-outerbox",layoutMode:"masonry",sortBy:"savedOn",sortAscending:!1,getSortData:{savedOn:function(t){return t.data("saved_on")}}},initialize:function(){var t=this.$el.innerWidth(),e=parseInt(t/this.columnWidth);this.columnWidth=this.columnWidth+(parseInt((t-e*this.columnWidth)/e)-1),this.$el.isotope(this.isotoptions)},refresh:function(){var t=this;this.$el.imagesLoaded(function(){t.$el.isotope(t.isotoptions)})}}),app.views.Text=Backbone.View.extend({tagName:"p",className:"gignal-text",re_links:/(\b(https?):\/\/[\-A-Z0-9+&@#\/%?=~_|!:,.;]*[\-A-Z0-9+&@#\/%=~_|])/gi,render:function(){var t=this.model.get("text");return t=t.replace(this.re_links,'<a href="$1" target="_top">link</a>'),this.$el.html(t),this}}),app.views.TextBox=Backbone.View.extend({tagName:"blockquote",className:"gignal-outerbox",initialize:function(){this.text=new app.views.Text({model:this.model}).render(),this.footer=new app.views.Footer({model:this.model}).render()},render:function(){return this.$el.data("saved_on",this.model.get("saved_on")),this.$el.css("width",app.view.columnWidth),this.$el.html(this.text.el),this.$el.append(this.footer.el),this}}),app.views.PhotoBox=Backbone.View.extend({tagName:"blockquote",className:"gignal-outerbox gignal-imagebox",initialize:function(){this.footer=new app.views.Footer({model:this.model}).render()},render:function(){return this.$el.data("saved_on",this.model.get("saved_on")),this.$el.css("width",app.view.columnWidth),this.$el.css("background-image","url("+this.model.get("thumb_photo")+")"),this.$el.append(this.footer.el),this}}),app.views.Footer=Backbone.View.extend({tagName:"div",className:"gignal-box-footer",initialize:function(){this.serviceImg=(new Backbone.View).make("img",{src:"images/"+this.model.get("service")+".png",alt:"Service"}),this.avatar=(new Backbone.View).make("img",{src:this.model.get("user_image"),"class":"gignal-avatar",alt:"Avatar"}),this.serviceProfileLink=(new Backbone.View).make("a",{href:"http://"+this.model.get("service")+".com/"+this.model.get("username")})},render:function(){return $(this.serviceProfileLink).append(this.avatar),$(this.serviceProfileLink).append(this.model.get("name")),this.$el.html(this.serviceImg),this.$el.append(this.serviceProfileLink),this}}),app.Router=Backbone.Router.extend({routes:{"event/:id":"event",":id":"event"},event:function(t){app.event=new app.models.Event({id:t}),app.stream=new app.collections.Stream}}),function(t){t(function(){app.view=new app.views.Event,new app.Router,Backbone.history.start({pushState:!0,root:"/widget/"})})}(jQuery);var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-183817-27"]),_gaq.push(["_trackPageview"]),function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}()